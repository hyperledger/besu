# Tracer Specification Files

This directory contains specification files for various Ethereum tracers. These specs include request/response pairs
from Geth and are used to verify that alternative implementations (like Besu) produce matching output.

## Test Blockchain Source

These specifications were generated from a Geth test node initialized with `../chain-data/blocks.bin`, which contains
33 pre-built test blocks (0x0 to 0x21) covering various EVM scenarios. The Geth node was started with debug APIs
enabled, and the tracer specs were generated by querying `debug_traceBlockByNumber` for each block with different
tracer configurations.

**Initialization commands:**
```bash
cd ../chain-data

# Initialize with genesis configuration
geth init --datadir ./data genesis.json

# Import pre-built blocks
geth import --datadir ./data blocks.bin
```

## Directory Structure

Each tracer has its own directory under `specs/`:

- **`call-tracer/`** - 34 files - Call tracer specs
- **`prestate-tracer/`** - Pre-state tracer specs
  - `diff-mode-false/` - 33 files - Pre-state only
  - `diff-mode-true/` - 33 files - Pre and post state
- **`4byte-tracer/`** - 34 files - Function signature tracer

## Tracer Types

### callTracer
Traces call execution including:
- Call type (CALL, DELEGATECALL, STATICCALL, CREATE, etc.)
- From/to addresses
- Gas usage
- Input/output data
- Value transfers

**Files**: `{number}-debug-call-tracer-0x{block}-{description}.json`

### prestateTracer
Captures state before (and optionally after) transaction execution:
- Account balances
- Nonces
- Storage values
- Code

**Modes**:
- `diffMode: false` - Shows only pre-state
- `diffMode: true` - Shows both pre and post state

**Files**: `block_0x{block}.json`

### 4byteTracer
Detects function signatures in transaction calldata:
- Function selector (first 4 bytes)
- Calldata length
- Call frequency

**Files**: `{number}-debug-4byte-tracer-0x{block}-{description}.json`

## File Format

All spec files use the same structure:

```json
{
  "request": {
    "jsonrpc": "2.0",
    "method": "debug_traceBlockByNumber",
    "params": [
      "0x2",
      {
        "tracer": "callTracer"
      }
    ],
    "id": 1
  },
  "response": {
    "jsonrpc": "2.0",
    "id": 1,
    "result": [ /* tracer-specific output */ ]
  },
  "statusCode": 200
}
```

## Coverage

All tracers cover the same 34 blocks (0x0 to 0x21) from the test blockchain:
- Genesis block (0x0)
- Empty block (0x1)
- Simple transfers
- Contract deployments
- Contract calls (CALL, CALLCODE, DELEGATECALL, STATICCALL)
- Self-destructs
- CREATE/CREATE2 operations
- ERC20 token operations
- Error cases (reverts, out of gas, invalid opcodes)
- Edge cases

## Usage

These specs are intended for:
1. **Validation**: Verify alternative implementations match Geth's output
2. **Testing**: Automated test suites can load and validate against these specs
3. **Documentation**: Reference for expected tracer behavior
4. **Debugging**: Compare actual output against known-good responses
